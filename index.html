<!DOCTYPE html>
<html>
<head>
	<title>Bug1043545 - Invlid CORS errors</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body>

This page test the CORS problem <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1043545">https://bugzilla.mozilla.org/show_bug.cgi?id=1043545</a>.
<h1 id="result"></h1>

<script type="application/javascript">
$(document).ready(function(){

	request(
		"http://elasticsearch-private.bugs.scl3.mozilla.com:9200/does_not_exist/_mapping",  //FORCE A 404
		function doneBadRequest(result){
			console.info("result = "+result);
			request(
				"http://elasticsearch-private.bugs.scl3.mozilla.com:9200/private_bugs/bug_version/_mapping", //LEGITIMATE
				function doneGoodRequest(result){
					console.info("result = "+result);
					if (result != 200) {
						$("#result").html("FAIL!!")
					} else {
						$("#result").html("PASS!!")
					}
				}
			)
		}
	);
});//method


function request(url, callback){
	var request = new XMLHttpRequest();
	try {
		request.open('GET', url);
		request.isDone = false;
		request.onreadystatechange = function(){
			if (request.isDone) return;
			if (request.readyState == 4){
				request.isDone = true;
				callback(request.status)
			}//endif
		};
		request.send(null);
	} catch (e) {
		callback('error sending');
	}//try
}//function


</script>

</body>
</html>
